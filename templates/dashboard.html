<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WB Print Manager - –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–µ—á–∞—Ç—å—é</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }
        
        .content {
            padding: 30px;
        }
        
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .status-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #007bff;
            text-align: center;
        }
        
        .status-card h3 {
            color: #495057;
            margin-bottom: 10px;
        }
        
        .status-card .value {
            font-size: 2em;
            font-weight: bold;
            color: #007bff;
        }
        
        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .control-panel {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            border: 1px solid #dee2e6;
        }
        
        .control-panel h3 {
            color: #495057;
            margin-bottom: 20px;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1em;
            margin: 5px;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            background: #0056b3;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: #28a745;
        }
        
        .btn-success:hover {
            background: #1e7e34;
        }
        
        .btn-danger {
            background: #dc3545;
        }
        
        .btn-danger:hover {
            background: #c82333;
        }
        
        .btn-warning {
            background: #ffc107;
            color: #212529;
        }
        
        .btn-warning:hover {
            background: #e0a800;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #495057;
            font-weight: 500;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 1em;
        }
        
        .queue-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            border: 1px solid #dee2e6;
        }
        
        .queue-section h3 {
            color: #495057;
            margin-bottom: 20px;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        
        .task-item {
            background: white;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 6px;
            border-left: 4px solid #007bff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .task-item h4 {
            color: #495057;
            margin-bottom: 5px;
        }
        
        .task-item p {
            color: #6c757d;
            font-size: 0.9em;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-pending { background: #ffc107; }
        .status-printing { background: #007bff; }
        .status-completed { background: #28a745; }
        
        .alert {
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 6px;
            border: 1px solid transparent;
        }
        
        .alert-success {
            background: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
        
        .alert-error {
            background: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 768px) {
            .status-grid, .controls-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üñ®Ô∏è WB Print Manager</h1>
            <p>–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–µ—á–∞—Ç—å—é –∑–∞–∫–∞–∑–æ–≤ Wildberries</p>
        </div>
        
        <div class="content">
            <!-- –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã -->
            <div class="status-grid">
                <div class="status-card">
                    <h3>–ü—Ä–∏–Ω—Ç–µ—Ä—ã</h3>
                    <div class="value" id="printers-count">0</div>
                </div>
                <div class="status-card">
                    <h3>–ó–∞–¥–∞—á–∏ –≤ –æ—á–µ—Ä–µ–¥–∏</h3>
                    <div class="value" id="queue-count">0</div>
                </div>
                <div class="status-card">
                    <h3>–ü—Ä–æ—Ü–µ—Å—Å–æ—Ä</h3>
                    <div class="value" id="processor-status">–û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω</div>
                </div>
            </div>
            
            <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
            <div id="notifications"></div>
            
            <!-- –ü–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
            <div class="controls-grid">
                <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–Ω—Ç–µ—Ä–∞–º–∏ -->
                <div class="control-panel">
                    <h3>üñ®Ô∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–Ω—Ç–µ—Ä–∞–º–∏</h3>
                    
                    <div class="form-group">
                        <label for="printer-id">ID –ø—Ä–∏–Ω—Ç–µ—Ä–∞:</label>
                        <input type="text" id="printer-id" placeholder="printer_1">
                    </div>
                    
                    <div class="form-group">
                        <label for="printer-name">–ù–∞–∑–≤–∞–Ω–∏–µ:</label>
                        <input type="text" id="printer-name" placeholder="–ü—Ä–∏–Ω—Ç–µ—Ä —Å–∫–ª–∞–¥–∞ –ê">
                    </div>
                    
                    <div class="form-group">
                        <label for="printer-type">–¢–∏–ø:</label>
                        <select id="printer-type">
                            <option value="thermal">–¢–µ—Ä–º–æ–ø—Ä–∏–Ω—Ç–µ—Ä</option>
                            <option value="laser">–õ–∞–∑–µ—Ä–Ω—ã–π</option>
                            <option value="inkjet">–°—Ç—Ä—É–π–Ω—ã–π</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="printer-location">–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:</label>
                        <input type="text" id="printer-location" placeholder="–°–∫–ª–∞–¥ –ê">
                    </div>
                    
                    <button class="btn btn-success" onclick="addPrinter()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–Ω—Ç–µ—Ä</button>
                    <button class="btn btn-danger" onclick="removePrinter()">‚ûñ –£–¥–∞–ª–∏—Ç—å –ø—Ä–∏–Ω—Ç–µ—Ä</button>
                </div>
                
                <!-- –°–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–∏–Ω—Ç–µ—Ä—ã -->
                <div class="control-panel">
                    <h3>üíª –°–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–∏–Ω—Ç–µ—Ä—ã</h3>
                    
                    <button class="btn" onclick="loadSystemPrinters()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫</button>
                    <button class="btn" onclick="loadWorkgroupPrinters()">üè∑Ô∏è –†–∞–±–æ—á–∞—è –≥—Ä—É–ø–ø–∞</button>
                    <button class="btn btn-success" id="add-selected-to-group" style="display:none; margin-top:10px;" onclick="addSelectedToWorkgroup()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –≤ –≥—Ä—É–ø–ø—É</button>
                    <div id="system-printers-list" style="margin-top: 15px; max-height: 200px; overflow-y: auto;">
                        <p>–ù–∞–∂–º–∏—Ç–µ "–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫" –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ø—Ä–∏–Ω—Ç–µ—Ä–æ–≤</p>
                    </div>
                </div>
                
                <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—á–∞—Ç—å—é -->
                <div class="control-panel">
                    <h3>üîÑ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—á–∞—Ç—å—é</h3>
                    
                    <button class="btn btn-success" onclick="addOrders()">üìã –î–æ–±–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑—ã</button>
                    <button class="btn btn-warning" onclick="startProcessor()">‚ñ∂Ô∏è –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä</button>
                    <button class="btn btn-danger" onclick="stopProcessor()">‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä</button>
                    <button class="btn" onclick="generateExcel()">üìä –°–æ–∑–¥–∞—Ç—å Excel –æ—Ç—á–µ—Ç</button>
                </div>
            </div>
            
            <!-- –û—á–µ—Ä–µ–¥—å –ø–µ—á–∞—Ç–∏ –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ -->
            <div class="queue-section">
                <h3>üìã –û—á–µ—Ä–µ–¥—å –ø–µ—á–∞—Ç–∏</h3>
                <div id="queue-list">
                    <p>–ó–∞–≥—Ä—É–∑–∫–∞ –æ—á–µ—Ä–µ–¥–∏...</p>
                </div>
            </div>
            
            <!-- –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ -->
            <div class="queue-section">
                <h3>‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏</h3>
                <div id="completed-tasks-list">
                    <p>–ó–∞–≥—Ä—É–∑–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á...</p>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –¥–ª—è real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
        let ws = null;
        
        function connectWebSocket() {
            ws = new WebSocket(`ws://${window.location.host}/ws`);
            
            ws.onmessage = function(event) {
                const status = JSON.parse(event.data);
                updateStatus(status);
            };
            
            ws.onclose = function() {
                setTimeout(connectWebSocket, 1000);
            };
        }
        
        function updateStatus(status) {
            document.getElementById('printers-count').textContent = status.printers_count;
            document.getElementById('queue-count').textContent = status.queue_count;
            document.getElementById('processor-status').textContent = 
                status.processor_running ? '–†–∞–±–æ—Ç–∞–µ—Ç' : '–û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω';
        }
        
        function showNotification(message, type = 'success') {
            const notifications = document.getElementById('notifications');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            notifications.appendChild(alert);
            
            setTimeout(() => {
                alert.remove();
            }, 5000);
        }
        
        async function apiCall(endpoint, method = 'GET', data = null) {
            try {
                const options = {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    }
                };
                
                if (data) {
                    options.body = JSON.stringify(data);
                }
                
                const response = await fetch(`/api/${endpoint}`, options);
                const result = await response.json();
                
                if (!response.ok) {
                    throw new Error(result.detail || '–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞');
                }
                
                return result;
            } catch (error) {
                showNotification(error.message, 'error');
                throw error;
            }
        }
        
        async function addPrinter() {
            const printerData = {
                id: document.getElementById('printer-id').value,
                name: document.getElementById('printer-name').value,
                type: document.getElementById('printer-type').value,
                location: document.getElementById('printer-location').value
            };
            
            if (!printerData.id) {
                showNotification('ID –ø—Ä–∏–Ω—Ç–µ—Ä–∞ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω', 'error');
                return;
            }
            
            try {
                const result = await apiCall('printers', 'POST', printerData);
                showNotification(result.message);
                loadPrinters();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–Ω—Ç–µ—Ä–∞:', error);
            }
        }
        
        async function removePrinter() {
            const printerId = document.getElementById('printer-id').value;
            if (!printerId) {
                showNotification('–í–≤–µ–¥–∏—Ç–µ ID –ø—Ä–∏–Ω—Ç–µ—Ä–∞ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è', 'error');
                return;
            }
            
            try {
                const result = await apiCall(`printers/${printerId}`, 'DELETE');
                showNotification(result.message);
                loadPrinters();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–∏–Ω—Ç–µ—Ä–∞:', error);
            }
        }
        
        async function addOrders() {
            try {
                const result = await apiCall('orders/add', 'POST');
                showNotification(result.message);
                loadQueue();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–æ–≤:', error);
            }
        }
        
        async function startProcessor() {
            try {
                const result = await apiCall('processor/start', 'POST');
                showNotification(result.message);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞:', error);
            }
        }
        
        async function stopProcessor() {
            try {
                const result = await apiCall('processor/stop', 'POST');
                showNotification(result.message);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞:', error);
            }
        }
        
        async function generateExcel() {
            try {
                const result = await apiCall('excel/generate', 'GET');
                showNotification(result.message);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è Excel –æ—Ç—á–µ—Ç–∞:', error);
            }
        }
        
        async function loadQueue() {
            try {
                const result = await apiCall('queue', 'GET');
                console.log('–ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏:', result.tasks);
                const queueList = document.getElementById('queue-list');
                
                if (result.tasks.length === 0) {
                    queueList.innerHTML = '<p>–û—á–µ—Ä–µ–¥—å –ø—É—Å—Ç–∞</p>';
                    return;
                }
                
                queueList.innerHTML = result.tasks.map(task => `
                    <div class="task-item">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                            <div style="flex: 1;">
                                <h4>
                                    <span class="status-indicator status-${task.status}"></span>
                                    –ó–∞–¥–∞—á–∞ ${task.id}
                                </h4>
                                <p>–ê—Ä—Ç–∏–∫—É–ª: ${task.article}</p>
                                <p>–°—Ç–∞—Ç—É—Å: ${task.status}</p>
                                <p>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: ${task.priority}</p>
                                ${task.assigned_printer ? `<p>–ü—Ä–∏–Ω—Ç–µ—Ä: ${task.assigned_printer}</p>` : ''}
                            </div>
                            <button class="btn btn-danger" style="padding: 6px 12px; font-size: 0.8em;" onclick="removeTask('${task.id}')">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ—á–µ—Ä–µ–¥–∏:', error);
            }
        }
        
        async function loadSystemPrinters() {
            try {
                const result = await apiCall('system/printers', 'GET');
                const printersList = document.getElementById('system-printers-list');
                const addBtn = document.getElementById('add-selected-to-group');
                if (result.printers.length === 0) {
                    printersList.innerHTML = '<p>–°–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–∏–Ω—Ç–µ—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>';
                    addBtn.style.display = 'none';
                    return;
                }
                addBtn.style.display = 'inline-block';
                printersList.innerHTML = result.printers.map(printer => `
                    <div class="task-item" style="margin-bottom: 8px; display: flex; align-items: center;">
                        <input type="checkbox" class="sys-printer-checkbox" value="${printer.name}" style="margin-right: 10px;">
                        <div style="flex:1;">
                            <h4 style="margin-bottom: 5px;">${printer.name}</h4>
                            <p style="font-size: 0.8em; margin: 2px 0;">–¢–∏–ø: ${printer.type} | –°—Ç–∞—Ç—É—Å: ${printer.status}</p>
                            <p style="font-size: 0.8em; margin: 2px 0;">
                                ${printer.location ? `–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ: ${printer.location} | ` : ''}
                                ${printer.port ? `–ü–æ—Ä—Ç: ${printer.port}` : ''}
                            </p>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ø—Ä–∏–Ω—Ç–µ—Ä–æ–≤', 'error');
            }
        }
        
        async function addSelectedToWorkgroup() {
            const checkboxes = document.querySelectorAll('.sys-printer-checkbox:checked');
            const names = Array.from(checkboxes).map(cb => cb.value);
            if (names.length === 0) {
                showNotification('–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –ø—Ä–∏–Ω—Ç–µ—Ä', 'error');
                return;
            }
            try {
                const result = await apiCall('workgroup/printers/add-multiple', 'POST', { names, workgroup: 'wb_print_group' });
                showNotification('–ü—Ä–∏–Ω—Ç–µ—Ä—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ —Ä–∞–±–æ—á—É—é –≥—Ä—É–ø–ø—É');
                loadWorkgroupPrinters();
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –≥—Ä—É–ø–ø—É', 'error');
            }
        }

        async function loadWorkgroupPrinters() {
            const addBtn = document.getElementById('add-selected-to-group');
            addBtn.style.display = 'none';
            try {
                const result = await apiCall('workgroup/printers', 'GET');
                const printersList = document.getElementById('system-printers-list');
                if (result.printers.length === 0) {
                    printersList.innerHTML = '<p>–†–∞–±–æ—á–∞—è –≥—Ä—É–ø–ø–∞ –ø—É—Å—Ç–∞</p>';
                    return;
                }
                printersList.innerHTML = result.printers.map(printer => `
                    <div class="task-item" style="margin-bottom: 8px; display: flex; align-items: center;">
                        <div style="flex:1;">
                            <h4 style="margin-bottom: 5px;">${printer.name}</h4>
                            <p style="font-size: 0.8em; margin: 2px 0;">–¢–∏–ø: ${printer.type} | –°—Ç–∞—Ç—É—Å: ${printer.status}</p>
                        </div>
                        <button class="btn btn-danger" style="padding: 4px 8px; font-size: 0.8em;" onclick="removeFromWorkgroup('${printer.name}')">‚ûñ –ò–∑ –≥—Ä—É–ø–ø—ã</button>
                    </div>
                `).join('');
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏–Ω—Ç–µ—Ä–æ–≤ –≥—Ä—É–ø–ø—ã', 'error');
            }
        }
        
        async function removeFromWorkgroup(printerName) {
            try {
                const result = await apiCall(`workgroup/printers/${encodeURIComponent(printerName)}`, 'DELETE');
                showNotification(result.message);
                loadWorkgroupPrinters();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∏–∑ –≥—Ä—É–ø–ø—ã:', error);
            }
        }
        
        async function removeTask(taskId) {
            console.log('–£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏:', taskId);
            
            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –∑–∞–¥–∞—á—É –∏–∑ –æ—á–µ—Ä–µ–¥–∏?')) {
                return;
            }
            
            try {
                console.log('–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ...');
                const result = await apiCall(`queue/task/${taskId}`, 'DELETE');
                console.log('–†–µ–∑—É–ª—å—Ç–∞—Ç —É–¥–∞–ª–µ–Ω–∏—è:', result);
                showNotification(result.message);
                loadQueue();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∏:', error);
                showNotification('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∏: ' + error.message, 'error');
            }
        }
        
        async function loadCompletedTasks() {
            try {
                const result = await apiCall('completed-tasks', 'GET');
                const completedList = document.getElementById('completed-tasks-list');
                
                if (result.tasks.length === 0) {
                    completedList.innerHTML = '<p>–í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á –Ω–µ—Ç</p>';
                    return;
                }
                
                completedList.innerHTML = result.tasks.map(task => `
                    <div class="task-item">
                        <h4>
                            <span class="status-indicator status-completed"></span>
                            –ó–∞–¥–∞—á–∞ ${task.id}
                        </h4>
                        <p>–ê—Ä—Ç–∏–∫—É–ª: ${task.article}</p>
                        <p>–°—Ç–∞—Ç—É—Å: ${task.status}</p>
                        <p>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: ${task.priority}</p>
                        ${task.assigned_printer ? `<p>–ü—Ä–∏–Ω—Ç–µ—Ä: ${task.assigned_printer}</p>` : ''}
                        <p>–í—Ä–µ–º—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è: ${task.completed_at || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</p>
                    </div>
                `).join('');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á:', error);
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            connectWebSocket();
            loadQueue();
            loadCompletedTasks();
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—á–µ—Ä–µ–¥–∏ –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
            setInterval(loadQueue, 10000);
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
            setInterval(loadCompletedTasks, 30000);
        });
    </script>
</body>
</html> 